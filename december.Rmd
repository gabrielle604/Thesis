---
title: "december"
author: "Gabrielle"
date: '2022-12-13'
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning = FALSE,results=FALSE)
library(tidyverse)
library(here)
library(ggpubr) # for some graphic applications that extend ggplot2
library(janitor)
library(broom) # used to make tables
library(knitr) # used to make table
library(car) # has leveneTest 
library(foreign) # to read in NHANES data
library(rstanarm) # for the model fitting
```

## Load in the data: years 2001-2016
- demographics file
- phthalates, urine file

downloaded from CDC National Health and Examination Survey, [NHANES Questionnaires, Datasets, and Related Documentation](https://wwwn.cdc.gov/nchs/nhanes/Default.aspx)

```{r}
# 2001-2002
demographics01 <- read.xport(here("data","DEMO_B_2001_2002.XPT"))
phthalates01 <- read.xport(here("data","PHPYPA_B_2001_2002.XPT"))
nhanes01 <- merge(phthalates01,demographics01,all.x=T)

# 2003-2004
demographics03 <- read.xport(here("data","DEMO_C_2003_2004.XPT"))
phthalates03 <- read.xport(here("data","L24PH_C_2003_2004.XPT"))
nhanes03 <- merge(phthalates03,demographics03,all.x=T)

# 2005-2006
demographics05 <- read.xport(here("data","DEMO_D_2005_2006.XPT"))
phthalates05 <- read.xport(here("data","PHTHTE_D_2005_2006.XPT"))
nhanes05 <- merge(phthalates05,demographics05,all.x=T)

# 2007-2008
demographics07 <- read.xport(here("data","DEMO_E_2007_2008.XPT"))
phthalates07 <- read.xport(here("data","PHTHTE_E_2007_2008.XPT"))
nhanes07 <- merge(phthalates07,demographics07,all.x=T)

# 2009-2010
demographics09 <- read.xport(here("data","DEMO_F_2009_2010.XPT"))
phthalates09 <- read.xport(here("data","PHTHTE_F_2009_2010.XPT"))
nhanes09 <- merge(phthalates09,demographics09,all.x=T)

# 2011-2012
demographics11 <- read.xport(here("data","DEMO_G_2011_2012.XPT"))
phthalates11 <- read.xport(here("data","PHTHTE_G_2011_2012.XPT"))
nhanes11 <- merge(phthalates11,demographics11,all.x=T)

# 2013-2014
demographics13 <- read.xport(here("data","DEMO_H_2013_2014.XPT"))
phthalates13 <- read.xport(here("data","PHTHTE_H_2013_2014.XPT"))
nhanes13 <- merge(phthalates13,demographics13,all.x=T)

# 2015-2016
demographics15 <- read.xport(here("data","DEMO_I_2015_2016.XPT"))
phthalates15 <- read.xport(here("data","PHTHTE_I_2015_2016.XPT"))
nhanes15 <- merge(phthalates15,demographics15,all.x=T)

## add a column with the year to each data file:

nhanes01$year <- 2001
nhanes03$year <- 2003
nhanes05$year <- 2005
nhanes07$year <- 2007
nhanes09$year <- 2009
nhanes11$year <- 2011
nhanes13$year <- 2013
nhanes15$year <- 2015

## choose the variables to select from each data file:
var<-c('year','DMDEDUC3','DMDEDUC2','DMDHREDU','DMDHSEDU','RIDAGEYR','RIAGENDR','RIDRETH1','INDFMPIR','DMDYRSUS','DMDCITZN','URXMEP')
nhanes01s<-subset(nhanes01,select=var)
nhanes03s<-subset(nhanes03,select=var)
nhanes05s<-subset(nhanes05,select=var)
nhanes07s<-subset(nhanes07,select=var)
nhanes09s<-subset(nhanes09,select=var)
nhanes11s<-subset(nhanes11,select=var)
nhanes13s<-subset(nhanes13,select=var)
nhanes15s<-subset(nhanes15,select=var)

## create one dataset for NHANES demographics and phthalates, year 2001-2016
nhanes <- rbind(nhanes01s,nhanes03s,nhanes05s,nhanes07s,nhanes09s,nhanes11s,nhanes13s,nhanes15s)

## create a data file so that I don't need to load, clean, and select the data again
# has all demographics and URXMEP phthalate for NHANES year 2001-2016
write.csv(nhanes, "nhanes_december22.csv")

```


## Visually inspect the data:
After inspecting the phthalate data in its raw form and the log form, we determined it is necessary to log transform the data in order to visualize it.

```{r}
hist(nhanes$URXMEP)
hist(log(nhanes$URXMEP))

nhanes$log_monoethyl = log(nhanes$URXMEP)
```

## Re-categorize the data:
Original:
- year = year the observation took place *this was added by me when I merged the years of data
- DMDEDUC3 = the highest grade level of education completed by participants 6-19 y.o.
- DMDEDUC2 = the highest grade/level of education completed by participants 20 years and older
- DMDHREDU = the household reference person's education level
- DMDHSEDU = the household reference person's spouse's education level
- RIDAGEYR = ages in years at screening
- RIAGENDR = gender
- RIDRETH1 = race/Hispanic origin
- INDFMPIR = ratio of family income to poverty
- DMDYRSUS = length of time in U.S.
- DMDCITZN = citizenship status
- URXMEP = mono-ethyl phthalate (ng/mL)

## Household reference person's education level

```{r}
hist(nhanes$DMDHREDU)

# add "edu_ref" to "nhanes" 
nhanes$edu_ref = factor(ifelse(nhanes$DMDHREDU %in% 1:4,"partial college and below",
                         ifelse(nhanes$DMDHREDU==5,"college and beyond",NA)),
                  levels=c("partial college and below","college and beyond"))
summary(nhanes$edu_ref)

```

## Age in years at screening
Based on the summary statistics of the variable "RIDAGEYR": the youngest participant is 3 years old, the oldest participant is 85 years old, and the median age is 31 years old. 

```{r}
hist(nhanes$RIDAGEYR)
summary(nhanes$RIDAGEYR)


# add "age" to "nhanes" 
nhanes$age = factor(ifelse(nhanes$RIDAGEYR >=65,"older adult",
                    ifelse(nhanes$RIDAGEYR >25 & nhanes$RIDAGEYR<64,"middle-aged",
                    ifelse(nhanes$RIDAGEYR >=19 & nhanes$RIDAGEYR<=25,"young adult",
                    ifelse(nhanes$RIDAGEYR <=18,"child",NA)))),
             levels=c("child","young adult", "middle-aged", "older adult"))
summary(nhanes$age)



```

## Gender
```{r}
RIAGENDR
```








## References:
- add a reference for why I am choosing college completion and above and partial college and below